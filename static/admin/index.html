<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>内容管理系统 - 张大的实验室</title>
    
    <!-- 引入 Decap CMS -->
    <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
    
    <style>
        #loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .spinner {
            width: 30px;
            height: 30px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4a6cf7;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 12px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="loading">
        <div class="spinner"></div>
        <div>正在加载内容管理系统...</div>
    </div>

    <!-- CMS 容器 -->
    <div id="nc-root"></div>

    <script>
        // 等待页面和 CMS 脚本完全加载
        document.addEventListener('DOMContentLoaded', function() {
            // 检查 CMS 是否已加载
            if (typeof CMS !== 'undefined') {
                initializeCMS();
            } else {
                // 如果 CMS 还没加载，等待一下再重试
                setTimeout(function() {
                    if (typeof CMS !== 'undefined') {
                        initializeCMS();
                    } else {
                        console.error('CMS 未加载');
                        document.getElementById('loading').innerHTML = 
                            '<div style="color: red; text-align: center; padding: 20px;">' +
                            '<h3>加载错误</h3>' +
                            '<p>内容管理系统加载失败，请刷新页面重试</p>' +
                            '</div>';
                    }
                }, 1000);
            }
        });

        function initializeCMS() {
            try {
                console.log('初始化 Decap CMS...');
                
                // 初始化 CMS
                CMS.init();
                
                // 监听 CMS 就绪事件
                CMS.registerEventListener({
                    name: 'preview',
                    handler: ({ entry, data }) => {
                        console.log('CMS 已就绪');
                        // 隐藏加载界面
                        document.getElementById('loading').style.display = 'none';
                    }
                });
                
                // 备用：3秒后隐藏加载界面
                setTimeout(function() {
                    const loading = document.getElementById('loading');
                    if (loading && loading.style.display !== 'none') {
                        loading.style.display = 'none';
                    }
                }, 3000);
                
            } catch (error) {
                console.error('CMS 初始化失败:', error);
                document.getElementById('loading').innerHTML = 
                    '<div style="color: red; text-align: center; padding: 20px;">' +
                    '<h3>初始化错误</h3>' +
                    '<p>' + error.message + '</p>' +
                    '</div>';
            }
        }
    </script>
</body>
</html>